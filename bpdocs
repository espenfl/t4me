#/usr/bin/env bash
# should check that we do not have
# any non commited changes not related to
# the documentation

# build the docs
cd docs
make clean
make html
cd ..

# add built docs to master repo (I do not
# really like this, would be nice to have it clean)
git add docs/_build/html
git commit -m "Updated documentation for later gh-pages push"
git push origin master

# switch branches and pull the data we want
git checkout gh-pages
rm *.html
rm *.js
rm *.inv
rm -r _images
rm -r _sources
rm -r _static
touch .nojekyll
git checkout master docs/_build/html

# now we only need html content for gh-pages
mv ./docs/_build/html/* ./
rm -rf ./docs

# add, commit and push gh-pages
git add -A
git commit -m "Publishing updated documentation"
git push origin gh-pages

# switch back to master branch
git checkout master
